name: YouTube Auto Robot

on:
  workflow_dispatch:
    inputs:
      topic:
        description: 'Video Topic'
        required: false
        default: 'Passive Income'
      title:
        description: 'Video Title'  
        required: false
        default: 'Make $313/month with Passive Income'

jobs:
  create-upload:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
    - name: üì• Checkout code
      uses: actions/checkout@v4
    
    - name: üêç Setup Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: üõ†Ô∏è Setup System
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg python3-pip
        ffmpeg -version
    
    - name: üì¶ Install Python Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install --upgrade google-api-python-client
    
    - name: üé¨ Create Silent Audio
      run: |
        ffmpeg -f lavfi -i anullsrc=r=44100:cl=stereo -t 120 silent.mp4 -y
        echo "Audio file created: $(ls -la silent.mp4)"
    
    - name: üöÄ Run Real Pipeline
      env:
        VIDEO_TOPIC: ${{ github.event.inputs.topic || 'Passive Income' }}
        VIDEO_TITLE: ${{ github.event.inputs.title || 'Make $313/month with Passive Income' }}
        YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
        YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
        YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
      run: |
        echo "=== STARTING PIPELINE ==="
        echo "Topic: $VIDEO_TOPIC"
        echo "Title: $VIDEO_TITLE"
        
        # Run the pipeline
        python real_pipeline.py
        
        # Check result
        if [ $? -eq 0 ]; then
          echo "‚úÖ Pipeline successful"
        else
          echo "‚ùå Pipeline failed"
          exit 1
        fi
    
    - name: üìÅ Verify Output
      run: |
        echo "=== CHECKING OUTPUT ==="
        ls -la *.mp4 *.png *.jpg 2>/dev/null || echo "No media files found"
        
        if [ -f "output_video.mp4" ]; then
          echo "‚úÖ Found: output_video.mp4"
          mv output_video.mp4 final_video.mp4
        elif [ -f "video.mp4" ]; then
          echo "‚úÖ Found: video.mp4"
          mv video.mp4 final_video.mp4
        elif [ -f "final_video.mp4" ]; then
          echo "‚úÖ Found: final_video.mp4"
        else
          echo "‚ùå ERROR: No video file created!"
          find . -name "*.mp4" -type f | head -5
          exit 1
        fi
        
        echo "Video size: $(du -h final_video.mp4)"
    
    - name: üíæ Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: youtube-video
        path: final_video.mp4
        retention-days: 1
    
    - name: üéâ Complete
      if: success()
      run: |
        echo "========================================"
        echo "üéØ YOUTUBE AUTOMATION COMPLETE"
        echo "========================================"
        echo "Video saved: final_video.mp4"
        echo "Download from Artifacts section"
        echo "========================================"
