name: YouTube Auto Pipeline
on:
  schedule:
    - cron: '0 9,14,19 * * *'  # 9AM, 2PM, 7PM UTC daily
  workflow_dispatch:

jobs:
  create-and-upload:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg
        sudo apt-get install -y python3-pil
        sudo apt-get install -y espeak
        echo "âœ… Dependencies installed (FFmpeg + PIL only)"
        
    - name: Install Python packages
      run: |
        pip install --upgrade pip
        # Fixed versions to avoid errors
        pip install moviepy==1.0.3
        pip install Pillow==9.5.0
        pip install requests==2.31.0
        pip install gTTS==2.4.0
        pip install pyttsx3==2.90
        pip install google-api-python-client==2.104.0
        pip install google-auth-oauthlib==1.1.0
        pip install google-auth-httplib2==0.1.1
        
    - name: Run Real Pipeline
      env:
        # API Keys
        PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
        GOOGLE_CLIENT_ID: ${{ secrets.GOOGLE_CLIENT_ID }}
        GOOGLE_CLIENT_SECRET: ${{ secrets.GOOGLE_CLIENT_SECRET }}
        GOOGLE_PROJECT_ID: ${{ secrets.GOOGLE_PROJECT_ID }}
      run: |
        echo "ğŸš€ STARTING REAL YOUTUBE AUTOMATION"
        echo "===================================="
        python real_pipeline.py
        echo "âœ… Real automation completed successfully!"
        
    - name: List Created Files
      run: |
        echo "ğŸ“ Created Files:"
        ls -la *.mp4 *.png *.txt *.json 2>/dev/null || echo "No output files"
        
    - name: Upload Video Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: generated-videos
        path: |
          *.mp4
          *.png
          *.txt
          *.json
        
    - name: Success Notification
      run: |
        echo "ğŸ‰ REAL YouTube Automation System Active!"
        echo "ğŸ“… Next run: 9AM, 2PM, 7PM UTC Daily"
        echo "â° System will run automatically 24/7"
