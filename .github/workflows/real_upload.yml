name: YouTube Monetization Automation

on:
  workflow_dispatch:
    inputs:
      topic:
        description: 'Video Topic'
        required: false
        default: 'Passive Income'
      title:
        description: 'Video Title'
        required: false  
        default: 'How I Make $500/Day with YouTube Automation'

jobs:
  monetize-youtube:
    runs-on: ubuntu-latest
    timeout-minutes: 45  # Increased for upload
    
    steps:
    - name: üì• Checkout code
      uses: actions/checkout@v4
    
    - name: üêç Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: üì¶ Install System Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg wget gnupg libgbm-dev libnss3 libatk1.0-0 libatk-bridge2.0-0 libcups2 libxcomposite1 libxrandr2 libxdamage1 libxfixes3 libpango-1.0-0 libcairo2 libasound2t64
    
    - name: üîß Install Python Packages
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        playwright install chromium
        # Skip playwright install-deps - we installed them manually
    
    - name: üé¨ Create Monetized Video
      env:
        VIDEO_TITLE: ${{ github.event.inputs.title || 'How I Make $500/Day with YouTube Automation' }}
      run: |
        echo "üí∞ Creating MONETIZED video: $VIDEO_TITLE"
        python video_creator.py
        
        if [ -f "monetized_video.mp4" ]; then
          echo "‚úÖ Video created: monetized_video.mp4"
          echo "üìè Size: $(du -h monetized_video.mp4)"
        else
          echo "‚ùå Video creation failed"
          exit 1
        fi
    
    - name: üì§ Auto-Upload to YouTube
      env:
        YOUTUBE_EMAIL: ${{ secrets.YOUTUBE_EMAIL }}
        YOUTUBE_PASSWORD: ${{ secrets.YOUTUBE_PASSWORD }}
      run: |
        if [ -n "$YOUTUBE_EMAIL" ] && [ -n "$YOUTUBE_PASSWORD" ]; then
          echo "üöÄ Starting DIRECT YouTube upload (45 minute timeout)..."
          python youtube_uploader.py
          UPLOAD_RESULT=$?
          if [ $UPLOAD_RESULT -eq 0 ]; then
            echo "‚úÖ YouTube upload successful!"
          else
            echo "‚ö†Ô∏è Upload may have timed out but video was created"
            echo "Download video from Artifacts and upload manually"
          fi
        else
          echo "‚ö†Ô∏è YouTube credentials not set."
          echo "Add these GitHub Secrets to enable upload:"
          echo "1. YOUTUBE_EMAIL"
          echo "2. YOUTUBE_PASSWORD"
          echo "Video saved as artifact."
        fi
    
    - name: üíæ Save Video Artifact
      uses: actions/upload-artifact@v4
      with:
        name: youtube-video
        path: monetized_video.mp4
        retention-days: 30
    
    - name: üìä Monetization Report
      if: success()
      run: |
        echo "========================================"
        echo "üí∞ YOUTUBE MONETIZATION SYSTEM"
        echo "========================================"
        echo "Status: VIDEO CREATED ‚úì"
        
        if [ -n "$YOUTUBE_EMAIL" ] && [ -n "$YOUTUBE_PASSWORD" ]; then
          echo "Upload: ATTEMPTED (check logs above)"
        else
          echo "Upload: NEED CREDENTIALS"
          echo "Add to GitHub Secrets:"
          echo "1. YOUTUBE_EMAIL"
          echo "2. YOUTUBE_PASSWORD"
        fi
        
        echo ""
        echo "NEXT STEPS:"
        echo "1. Download video from Artifacts"
        echo "2. Go to https://studio.youtube.com"
        echo "3. Upload manually if needed"
        echo "4. Video earns $2-$10 per 1000 views"
        echo "========================================"
